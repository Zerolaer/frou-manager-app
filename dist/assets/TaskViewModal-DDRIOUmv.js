import{j as e,r as a,s as l}from"./index-CXPc7nnv.js";import{M as G}from"./Modal-CCkwcyuC.js";/* empty css                    */function J({checked:o,onToggle:i}){return e.jsxs("label",{className:"chk",style:{lineHeight:0},children:[e.jsx("input",{type:"checkbox",checked:o,onChange:i}),e.jsx("span",{className:"box",children:e.jsx("svg",{className:"icon",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L8.5 11.586l6.793-6.793a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})}function K({open:o,onClose:i,task:t,onUpdated:m}){const[d,c]=a.useState(""),[b,w]=a.useState(""),[h,S]=a.useState(""),[p,C]=a.useState(""),[y,_]=a.useState(""),[u,g]=a.useState([]),[f,T]=a.useState("open"),[O,$]=a.useState(!1),[M,D]=a.useState(null),[v,E]=a.useState(!1),[L,P]=a.useState([]),[j,R]=a.useState(""),N=a.useRef(null);a.useEffect(()=>{const r=s=>{N.current&&(N.current.contains(s.target)||$(!1))};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]),a.useEffect(()=>{o&&(c((t==null?void 0:t.title)||""),w((t==null?void 0:t.description)||""),S((t==null?void 0:t.priority)||""),C((t==null?void 0:t.tag)||""),_((t==null?void 0:t.date)||""),g(Array.isArray(t==null?void 0:t.todos)?t.todos:[]),T((t==null?void 0:t.status)||"open"),R((t==null?void 0:t.project_id)||""),D(null))},[o,t]),a.useEffect(()=>{o&&(async()=>{const{data:r}=await l.from("tasks_projects").select("id,name").order("created_at",{ascending:!0});P(r||[])})()},[o]);function A(){const r=Math.random().toString(36).slice(2);g(s=>[...s,{id:r,text:"Новая подзадача",done:!1}])}function z(r){g(s=>s.map(n=>n.id===r?{...n,done:!n.done}:n))}function I(r){g(s=>s.filter(n=>n.id!==r))}async function H(r){t&&(T(r),await l.from("tasks_items").update({status:r}).eq("id",t.id))}async function V(r){if(!t)return;R(r||""),await l.from("tasks_items").update({project_id:r}).eq("id",t.id);const{data:s}=await l.from("tasks_items").select("id,project_id,title,description,date,position,priority,tag,todos,status").eq("id",t.id).single();s&&m(s)}async function B(){if(!t)return;const r={project_id:j||null,title:d,description:b,date:y||null,position:(t.position??0)+1,priority:h||null,tag:p||null,todos:u,status:f},{data:s,error:n}=await l.from("tasks_items").insert(r).select("id").single();if(!n&&(s!=null&&s.id)){const{data:x}=await l.from("tasks_items").select("id,project_id,title,description,date,position,priority,tag,todos,status").eq("id",s.id).single();x&&m(x)}}async function F(){!t||!confirm("Удалить эту задачу?")||(await l.from("tasks_items").delete().eq("id",t.id),i())}async function q(){if(!t)return!1;E(!0);const r={title:d,description:b,priority:h||null,tag:p||null,date:y||null,todos:u,status:f,project_id:j||null},{data:s,error:n}=await l.from("tasks_items").update(r).eq("id",t.id).select("id,project_id,title,description,date,position,priority,tag,todos,status").single();return E(!1),!n&&s?(m(s),D(new Date().toLocaleTimeString()),!0):!1}a.useEffect(()=>{if(!o||!t)return;const r=setTimeout(()=>{q()},900);return()=>clearTimeout(r)},[d,b,h,p,y,u,f,j,o]);const Q=u.filter(r=>r.done).length,W=u.length;return e.jsx(G,{open:o,onClose:i,title:"Задача",size:"lg",bodyClassName:"p-0",contentClassName:"w-[880px] max-w-[95vw]",headerRight:e.jsxs("div",{className:"relative",ref:N,children:[e.jsx("button",{className:"h-8 w-8 grid place-items-center rounded-lg border border-gray-300 bg-white hover:bg-gray-50",onClick:()=>$(r=>!r),"aria-label":"Меню",children:"⋮"}),O&&e.jsxs("div",{className:"absolute right-0 mt-2 min-w-48 rounded-xl border border-gray-200 bg-white p-1 shadow-xl",children:[e.jsx("div",{className:"dd-item",onClick:B,children:"Дублировать"}),e.jsx("div",{className:"dd-item text-red-600",onClick:F,children:"Удалить"})]})]}),footer:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("div",{className:"text-xs text-gray-400",children:M?`Сохранено ${M}`:""}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"h-9 px-4 rounded-lg border border-gray-300 bg-white text-gray-900 hover:bg-gray-50 disabled:opacity-60",onClick:i,disabled:v,children:"Закрыть"}),e.jsx("button",{className:"h-9 px-4 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",onClick:async()=>{await q()&&i()},disabled:v,children:v?"Сохраняю…":"Сохранить"})]})]}),children:e.jsxs("div",{className:"grid grid-cols-[1fr_280px] gap-4 p-0 max-md:grid-cols-1",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Название"}),e.jsx("input",{value:d,onChange:r=>c(r.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-base font-semibold",placeholder:"Название задачи"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Описание"}),e.jsx("textarea",{value:b,onChange:r=>w(r.target.value),className:"w-full min-h-[140px] rounded-lg border border-gray-300 p-3",placeholder:"Добавьте детали задачи…"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Подзадачи"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[Q," / ",W]})]}),e.jsx("ul",{className:"mt-2 space-y-2",children:u.map(r=>e.jsxs("li",{className:"flex items-center gap-2 rounded-xl border border-gray-200 p-2",children:[e.jsx(J,{checked:r.done,onToggle:()=>z(r.id)}),e.jsx("input",{value:r.text,onChange:s=>g(n=>n.map(x=>x.id===r.id?{...x,text:s.target.value}:x)),className:"flex-1 bg-transparent outline-none"}),e.jsx("button",{className:"h-8 rounded-lg border border-gray-200 px-2 text-sm hover:bg-gray-50",onClick:()=>I(r.id),children:"Удалить"})]},r.id))}),e.jsx("button",{className:"h-9 px-4 rounded-lg border border-gray-300 bg-white hover:bg-gray-50 mt-3",onClick:A,children:"+ Подзадача"})]})]}),e.jsxs("aside",{className:"space-y-4",children:[e.jsxs("section",{className:"space-y-2 rounded-xl border border-gray-200 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Статус"}),e.jsx(X,{value:f,onChange:H,fullWidth:!0})]}),e.jsxs("section",{className:"space-y-2 rounded-xl border border-gray-200 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Приоритет"}),e.jsx(Y,{value:h,onChange:S})]}),e.jsxs("section",{className:"space-y-2 rounded-xl border border-gray-200 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Тег"}),e.jsx("input",{value:p||"",onChange:r=>C(r.target.value),placeholder:"Введите тег",className:"h-9 w-full rounded-xl border border-gray-200 px-3"})]}),e.jsxs("section",{className:"space-y-2 rounded-xl border border-gray-200 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Дата"}),e.jsx(Z,{value:y||"",onChange:_})]}),e.jsxs("section",{className:"space-y-2 rounded-xl border border-gray-200 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Проект"}),e.jsxs("select",{value:j,onChange:r=>V(r.target.value||null),className:"h-9 w-full rounded-xl border border-gray-200 px-3 bg-white",children:[e.jsx("option",{value:"",children:"Без проекта"}),L.map(r=>e.jsx("option",{value:r.id,children:r.name||"Без названия"},r.id))]})]})]})]})})}function X({value:o,onChange:i,fullWidth:t}){return e.jsxs("div",{className:(t?"w-full ":"")+"flex rounded-full border border-gray-200 bg-gray-100 p-1 text-xs",children:[e.jsx("button",{className:"flex-1 rounded-full px-3 py-1 text-center "+(o==="open"?"bg-white shadow-sm":"opacity-70 hover:opacity-100"),onClick:()=>i("open"),children:"Открытая"}),e.jsx("button",{className:"flex-1 rounded-full px-3 py-1 text-center "+(o==="closed"?"bg-white shadow-sm":"opacity-70 hover:opacity-100"),onClick:()=>i("closed"),children:"Закрытая"})]})}function Y({value:o,onChange:i}){const t="h-8 px-3 rounded-full border text-sm inline-flex items-center justify-center transition";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:`${t} ${o==="low"?"border-blue-300 bg-blue-50 text-blue-700":"border-gray-200 text-gray-700 hover:bg-gray-50"}`,onClick:()=>i("low"),children:"Low"}),e.jsx("button",{type:"button",className:`${t} ${o==="medium"?"border-amber-300 bg-amber-50 text-amber-700":"border-gray-200 text-gray-700 hover:bg-gray-50"}`,onClick:()=>i("medium"),children:"Med"}),e.jsx("button",{type:"button",className:`${t} ${o==="high"?"border-rose-300 bg-rose-50 text-rose-700":"border-gray-200 text-gray-700 hover:bg-gray-50"}`,onClick:()=>i("high"),children:"High"}),e.jsx("button",{type:"button",className:`${t} ${o===""?"bg-white shadow-sm":"border-gray-200 text-gray-500 hover:bg-gray-50"}`,onClick:()=>i(""),title:"Без приоритета",children:"Нет"})]})}function Z({value:o,onChange:i}){function t(c){return c.toISOString().slice(0,10)}const m=new Date,d=new Date(Date.now()+864e5);return e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"date",value:o||"",onChange:c=>i(c.target.value),className:"h-9 w-full rounded-xl border border-gray-200 px-3"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"h-8 rounded-lg border border-gray-200 px-2 text-sm hover:bg-gray-50",onClick:()=>i(t(m)),children:"Сегодня"}),e.jsx("button",{type:"button",className:"h-8 rounded-lg border border-gray-200 px-2 text-sm hover:bg-gray-50",onClick:()=>i(t(d)),children:"Завтра"})]})]})}const te=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"}));export{J as C,K as T,te as a};
