import{s as N,j as s}from"./index-BbY1QJhM.js";import{r}from"./vendor-CqGws4Uo.js";import{s as v,e as w}from"./dateUtils-BepG4-_g.js";import{D as l,g as S}from"./auth-BCu7gzHC.js";import"./supabase-BmeMSZYH.js";function I(){const[d,h]=r.useState([]),[p,n]=r.useState(!0),[o,c]=r.useState(null),u=r.useMemo(()=>v(l.TZ).toISOString(),[]),m=r.useMemo(()=>w(l.TZ).toISOString(),[]);return r.useEffect(()=>{let t=!1;return(async()=>{n(!0),c(null);try{const e=l.tasks,y=[e.id,e.title,e.due,e.status,e.priority].filter(Boolean).join(",");let a=N.from(e.table).select(y);const x=e.userId,g=await S();x&&g&&(a=a.eq(x,g)),a=a.gte(e.due,u).lte(e.due,m),e.status&&(a=a.neq(e.status,e.statusDoneValue));const{data:j,error:f}=await a.order(e.priority||e.due,{ascending:!0}).limit(50);if(f)throw f;const b=j.map(i=>({id:i[e.id],title:i[e.title],due:i[e.due],status:e.status?i[e.status]:null,priority:e.priority?i[e.priority]:null}));t||h(b)}catch(e){t||c(e?.message||"Ошибка загрузки задач")}finally{t||n(!1)}})(),()=>{t=!0}},[u,m]),s.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-baseline gap-3",children:[s.jsx("h2",{className:"text-lg font-semibold tracking-[-0.01em]",children:"Задачи на сегодня"}),s.jsx("span",{className:"text-xs text-gray-500",children:new Date().toLocaleDateString("ru-RU")})]}),s.jsx("a",{href:"/tasks",className:"text-sm text-blue-600 hover:underline",children:"Открыть все"})]}),p?s.jsx("div",{className:"text-sm text-gray-500",children:"Загрузка…"}):o?s.jsxs("div",{className:"text-sm text-red-600",children:["Ошибка: ",o]}):d.length===0?s.jsx("div",{className:"text-sm text-gray-500",children:"На сегодня нет задач."}):s.jsx("ul",{className:"space-y-2",children:d.map(t=>s.jsxs("li",{className:"flex items-center gap-3 rounded-xl border border-gray-100 p-3 hover:bg-gray-50",children:[s.jsx("div",{className:"w-5 h-5 shrink-0 rounded border border-gray-300 bg-white"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-sm",children:t.title}),s.jsx("div",{className:"text-xs text-gray-500",children:t.due?`Срок: ${new Date(t.due).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:""})]}),s.jsx("a",{className:"btn",href:"/tasks",children:"Открыть"})]},t.id))})]})}export{I as TasksToday};
