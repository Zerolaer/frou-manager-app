import{j as e,r as o,s as u}from"./index-ByxKddn8.js";import{U as K,a as X,b as L}from"./ModalSystem-9TS_SLlg.js";/* empty css                    */function Y({checked:s,onToggle:n}){return e.jsxs("label",{className:"chk",style:{lineHeight:0},children:[e.jsx("input",{type:"checkbox",checked:s,onChange:n}),e.jsx("span",{className:"box",children:e.jsx("svg",{className:"icon",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L8.5 11.586l6.793-6.793a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})}function Z(s,n,t=[]){const a=o.useRef(),d=o.useRef(s);o.useEffect(()=>{d.current=s},[s]);const c=o.useCallback((...x)=>{a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{d.current(...x)},n)},[n,...t]);return o.useEffect(()=>()=>{a.current&&clearTimeout(a.current)},[]),c}function U({open:s,onClose:n,task:t,onUpdated:a}){const[d,c]=o.useState(""),[x,w]=o.useState(""),[b,C]=o.useState(""),[h,S]=o.useState(""),[p,_]=o.useState(""),[m,f]=o.useState([]),[y,T]=o.useState("open"),[P,R]=o.useState(!1),[E,M]=o.useState(null),[$,D]=o.useState(!1),[A,z]=o.useState([]),[j,q]=o.useState(""),v=o.useRef(null);o.useEffect(()=>{const r=i=>{v.current&&(v.current.contains(i.target)||R(!1))};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]),o.useEffect(()=>{s&&(c((t==null?void 0:t.title)||""),w((t==null?void 0:t.description)||""),C((t==null?void 0:t.priority)||""),S((t==null?void 0:t.tag)||""),_((t==null?void 0:t.date)||""),f(Array.isArray(t==null?void 0:t.todos)?t.todos:[]),T((t==null?void 0:t.status)||"open"),q((t==null?void 0:t.project_id)||""),M(null))},[s,t]),o.useEffect(()=>{s&&(async()=>{const{data:r}=await u.from("tasks_projects").select("id,name").order("created_at",{ascending:!0});z(r||[])})()},[s]);function F(){const r=Math.random().toString(36).slice(2);f(i=>[...i,{id:r,text:"Новая подзадача",done:!1}])}function I(r){f(i=>i.map(l=>l.id===r?{...l,done:!l.done}:l))}function B(r){f(i=>i.filter(l=>l.id!==r))}async function H(r){t&&(T(r),await u.from("tasks_items").update({status:r}).eq("id",t.id))}async function V(r){if(!t)return;q(r||""),await u.from("tasks_items").update({project_id:r}).eq("id",t.id);const{data:i}=await u.from("tasks_items").select("id,project_id,title,description,date,position,priority,tag,todos,status").eq("id",t.id).single();i&&a(i)}async function Q(){if(!t)return;const r={project_id:j||null,title:d,description:x,date:p||null,position:(t.position??0)+1,priority:b||null,tag:h||null,todos:m,status:y},{data:i,error:l}=await u.from("tasks_items").insert(r).select("id").single();if(!l&&(i!=null&&i.id)){const{data:g}=await u.from("tasks_items").select("id,project_id,title,description,date,position,priority,tag,todos,status").eq("id",i.id).single();g&&a(g)}}async function W(){!t||!confirm("Удалить эту задачу?")||(await u.from("tasks_items").delete().eq("id",t.id),n())}const N=o.useCallback(async()=>{if(!t)return!1;D(!0);const r={title:d,description:x,priority:b||null,tag:h||null,date:p||null,todos:m,status:y,project_id:j||null},{data:i,error:l}=await u.from("tasks_items").update(r).eq("id",t.id).select("id,project_id,title,description,date,position,priority,tag,todos,status").single();return D(!1),!l&&i?(a(i),M(new Date().toLocaleTimeString()),!0):!1},[t,d,x,b,h,p,m,y,j,a]),O=Z(N,900,[N]);o.useEffect(()=>{!s||!t||O()},[d,x,b,h,p,m,y,j,s,O]);const G=m.filter(r=>r.done).length,J=m.length;return e.jsx(K,{open:s,onClose:n,title:"Задача",size:"xl",bodyClassName:"p-0",headerRight:e.jsxs("div",{className:"relative",ref:v,children:[e.jsx("button",{className:"h-8 w-8 grid place-items-center rounded-lg border border-gray-300 bg-white hover:bg-gray-50",onClick:()=>R(r=>!r),"aria-label":"Меню",children:"⋮"}),P&&e.jsxs("div",{className:"absolute right-0 mt-2 min-w-48 rounded-xl border border-gray-200 bg-white p-1 shadow-xl",children:[e.jsx("div",{className:"dd-item",onClick:Q,children:"Дублировать"}),e.jsx("div",{className:"dd-item text-red-600",onClick:W,children:"Удалить"})]})]}),footer:e.jsx(X,{left:e.jsx("div",{className:"text-xs text-gray-400",children:E?`Сохранено ${E}`:""}),right:e.jsxs(e.Fragment,{children:[e.jsx(L,{variant:"secondary",onClick:n,disabled:$,children:"Закрыть"}),e.jsx(L,{variant:"primary",onClick:async()=>{await N()&&n()},loading:$,children:"Сохранить"})]})}),children:e.jsxs("div",{className:"grid grid-cols-[1fr_280px] gap-4 p-0 max-md:grid-cols-1",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Название"}),e.jsx("input",{value:d,onChange:r=>c(r.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-base font-semibold",placeholder:"Название задачи"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Описание"}),e.jsx("textarea",{value:x,onChange:r=>w(r.target.value),className:"w-full min-h-[140px] rounded-lg border border-gray-300 p-3",placeholder:"Добавьте детали задачи…"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Подзадачи"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[G," / ",J]})]}),e.jsx("ul",{className:"mt-2 space-y-2",children:m.map(r=>e.jsxs("li",{className:"flex items-center gap-2 rounded-xl border border-gray-200 p-2",children:[e.jsx(Y,{checked:r.done,onToggle:()=>I(r.id)}),e.jsx("input",{value:r.text,onChange:i=>f(l=>l.map(g=>g.id===r.id?{...g,text:i.target.value}:g)),className:"flex-1 bg-transparent outline-none"}),e.jsx("button",{className:"h-8 rounded-lg border border-gray-200 px-2 text-sm hover:bg-gray-50",onClick:()=>B(r.id),children:"Удалить"})]},r.id))}),e.jsx("button",{className:"h-9 px-4 rounded-lg border border-gray-300 bg-white hover:bg-gray-50 mt-3",onClick:F,children:"+ Подзадача"})]})]}),e.jsxs("aside",{className:"space-y-4",children:[e.jsxs("section",{className:"space-y-2 rounded-xl border border-gray-200 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Статус"}),e.jsx(k,{value:y,onChange:H,fullWidth:!0})]}),e.jsxs("section",{className:"space-y-2 rounded-xl border border-gray-200 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Приоритет"}),e.jsx(ee,{value:b,onChange:C})]}),e.jsxs("section",{className:"space-y-2 rounded-xl border border-gray-200 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Тег"}),e.jsx("input",{value:h||"",onChange:r=>S(r.target.value),placeholder:"Введите тег",className:"h-9 w-full rounded-xl border border-gray-200 px-3"})]}),e.jsxs("section",{className:"space-y-2 rounded-xl border border-gray-200 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Дата"}),e.jsx(te,{value:p||"",onChange:_})]}),e.jsxs("section",{className:"space-y-2 rounded-xl border border-gray-200 p-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Проект"}),e.jsxs("select",{value:j,onChange:r=>V(r.target.value||null),className:"h-9 w-full rounded-xl border border-gray-200 px-3 bg-white",children:[e.jsx("option",{value:"",children:"Без проекта"}),A.map(r=>e.jsx("option",{value:r.id,children:r.name||"Без названия"},r.id))]})]})]})]})})}function k({value:s,onChange:n,fullWidth:t}){return e.jsxs("div",{className:(t?"w-full ":"")+"flex rounded-full border border-gray-200 bg-gray-100 p-1 text-xs",children:[e.jsx("button",{className:"flex-1 rounded-full px-3 py-1 text-center "+(s==="open"?"bg-white shadow-sm":"opacity-70 hover:opacity-100"),onClick:()=>n("open"),children:"Открытая"}),e.jsx("button",{className:"flex-1 rounded-full px-3 py-1 text-center "+(s==="closed"?"bg-white shadow-sm":"opacity-70 hover:opacity-100"),onClick:()=>n("closed"),children:"Закрытая"})]})}function ee({value:s,onChange:n}){const t="h-8 px-3 rounded-full border text-sm inline-flex items-center justify-center transition";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:`${t} ${s==="low"?"border-blue-300 bg-blue-50 text-blue-700":"border-gray-200 text-gray-700 hover:bg-gray-50"}`,onClick:()=>n("low"),children:"Low"}),e.jsx("button",{type:"button",className:`${t} ${s==="medium"?"border-amber-300 bg-amber-50 text-amber-700":"border-gray-200 text-gray-700 hover:bg-gray-50"}`,onClick:()=>n("medium"),children:"Med"}),e.jsx("button",{type:"button",className:`${t} ${s==="high"?"border-rose-300 bg-rose-50 text-rose-700":"border-gray-200 text-gray-700 hover:bg-gray-50"}`,onClick:()=>n("high"),children:"High"}),e.jsx("button",{type:"button",className:`${t} ${s===""?"bg-white shadow-sm":"border-gray-200 text-gray-500 hover:bg-gray-50"}`,onClick:()=>n(""),title:"Без приоритета",children:"Нет"})]})}function te({value:s,onChange:n}){function t(c){return c.toISOString().slice(0,10)}const a=new Date,d=new Date(Date.now()+864e5);return e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"date",value:s||"",onChange:c=>n(c.target.value),className:"h-9 w-full rounded-xl border border-gray-200 px-3"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"h-8 rounded-lg border border-gray-200 px-2 text-sm hover:bg-gray-50",onClick:()=>n(t(a)),children:"Сегодня"}),e.jsx("button",{type:"button",className:"h-8 rounded-lg border border-gray-200 px-2 text-sm hover:bg-gray-50",onClick:()=>n(t(d)),children:"Завтра"})]})]})}const ne=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"}));export{Y as C,U as T,ne as a};
