import{s as b,j as t}from"./index-BJakucwa.js";import{r}from"./vendor-5APVzNZg.js";import{s as v,e as S}from"./dateUtils-BepG4-_g.js";import{D as l,g as T}from"./auth-BKPcReOB.js";import"./supabase-7cNBIxai.js";function I(){const[n,p]=r.useState([]),[g,d]=r.useState(!0),[o,c]=r.useState(null),u=r.useMemo(()=>v(l.TZ).toISOString(),[]),m=r.useMemo(()=>S(l.TZ).toISOString(),[]);return r.useEffect(()=>{let s=!1;return(async()=>{d(!0),c(null);try{const e=l.tasks,j=[e.id,e.title,e.due,e.status,e.priority].filter(Boolean).join(",");let a=b.from(e.table).select(j);const x=e.userId,f=await T();x&&f&&(a=a.eq(x,f)),a=a.gte(e.due,u).lte(e.due,m),e.status&&(a=a.neq(e.status,e.statusDoneValue));const{data:N,error:h}=await a.order(e.priority||e.due,{ascending:!0}).limit(50);if(h)throw h;const y=N.map(i=>({id:i[e.id],title:i[e.title],due:i[e.due],status:e.status?i[e.status]:null,priority:e.priority?i[e.priority]:null}));s||p(y)}catch(e){s||c(e?.message||"Ошибка загрузки задач")}finally{s||d(!1)}})(),()=>{s=!0}},[u,m]),t.jsxs("div",{className:"card",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-baseline gap-3",children:[t.jsx("h2",{className:"text-lg font-semibold",children:"Задачи на сегодня"}),t.jsx("span",{className:"text-xs text-neutral-500",children:new Date().toLocaleDateString("ru-RU")})]}),t.jsx("a",{href:"/tasks",className:"text-sm text-primary hover:underline",children:"Открыть все"})]}),g?t.jsx("div",{className:"text-sm text-neutral-500",children:"Загрузка…"}):o?t.jsxs("div",{className:"text-sm text-danger",children:["Ошибка: ",o]}):n.length===0?t.jsx("div",{className:"text-sm text-neutral-500",children:"На сегодня нет задач."}):t.jsx("ul",{className:"space-y-2",children:n.map(s=>t.jsxs("li",{className:"flex items-center gap-3 card-compact hover:bg-neutral-50",children:[t.jsx("div",{className:"w-5 h-5 shrink-0 rounded border border-neutral-300 bg-white"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-sm",children:s.title||"Без названия"}),t.jsx("div",{className:"text-xs text-neutral-500",children:s.due?`Срок: ${new Date(s.due).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}`:""})]}),t.jsx("a",{className:"btn btn-sm",href:"/tasks",children:"Открыть"})]},s.id))})]})}export{I as TasksToday};
