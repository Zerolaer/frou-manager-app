# Настройка Invoice функционала

## Установка базы данных

1. Откройте **Supabase Dashboard → SQL Editor**
2. Выполните SQL скрипт из файла `scripts/create-invoice-tables.sql`
3. Это создаст таблицы `invoices` и `invoice_items` с необходимыми RLS политиками

## Функционал

### Создание инвойса
- Нажмите кнопку "Новый инвойс"
- Заполните данные:
  - Номер инвойса
  - Данные клиента (имя, email, адрес)
  - Даты (дата создания, срок оплаты)
  - Налоговая ставка (опционально)
  - Позиции (описание, количество, цена)
  - Примечания (опционально)

### Редактирование
- Нажмите на иконку редактирования на карточке инвойса
- Измените необходимые поля
- Сохраните изменения

### Экспорт в PDF
- Нажмите кнопку "Экспорт в PDF" на карточке или в просмотре инвойса
- PDF файл будет автоматически скачан

### Автоматические расчеты
- Подытог рассчитывается автоматически как сумма всех позиций
- Налог рассчитывается от подытога по указанной ставке
- Итоговая сумма = Подытог + Налог

## Структура базы данных

### Таблица `invoices`
- `id` - UUID первичный ключ
- `user_id` - ID пользователя (связь с auth.users)
- `invoice_number` - Номер инвойса
- `client_name` - Имя клиента
- `client_email` - Email клиента (опционально)
- `client_address` - Адрес клиента (опционально)
- `date` - Дата создания
- `due_date` - Срок оплаты
- `notes` - Примечания (опционально)
- `subtotal` - Подытог
- `tax_rate` - Налоговая ставка (%)
- `tax_amount` - Сумма налога
- `total` - Итоговая сумма
- `created_at` - Дата создания записи
- `updated_at` - Дата последнего обновления

### Таблица `invoice_items`
- `id` - UUID первичный ключ
- `invoice_id` - ID инвойса (связь с invoices)
- `description` - Описание позиции
- `quantity` - Количество
- `price` - Цена за единицу
- `position` - Позиция в списке (для сортировки)
- `created_at` - Дата создания записи

## Безопасность

Все таблицы защищены Row Level Security (RLS):
- Пользователи видят только свои инвойсы
- Пользователи могут создавать/редактировать/удалять только свои инвойсы
- Все операции проверяются через `auth.uid()`

